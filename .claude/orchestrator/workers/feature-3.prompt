You are a worker agent focused on implementing a single feature.

## Your Task
Backend: Update auth middleware to read accessToken from req.cookies, with fallback to Authorization header for backward compatibility

## Orchestration Context
Migrate JWT token storage from localStorage to httpOnly cookies to eliminate XSS token theft vulnerability. This involves backend changes to set/read cookies and frontend changes to use credential-based requests.

## Project Context Files
### From CLAUDE.md:
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

CodeCollabProj is a web application for computer club members to collaborate on projects. It's a full-stack JavaScript application with a React frontend and Express.js backend using MongoDB.

## Development Commands

### Running the Application
```bash
npm run dev           # Start both client (port 3000) and server (port 5001) concurrently
npm run client        # Start only React dev server
npm run server        # Start only Express server with nodemon
npm run install-all   # Install dependencies for root, client, and server
```

### Testing
```bash
# Server tests (Jest)
cd server && npm test              # Run all server tests
cd server && npm run test:watch    # Watch mode
cd server && npm run test:coverage # With coverage

# Client tests (Jest via react-scripts)
cd client && npm test              # Run client tests in watch mode
```

### Database
```bash
cd server && npm run seed          # Seed database with sample data
```

### Building for Production
```bash
npm run build         # Build client for production
```

## Architecture

### Monorepo Structure
- `/client` - React 18 frontend (Create React App)
- `/server` - Express.js backend

### Backend Architecture (server/)
- **MVC Pattern**: Controllers handle business logic, Models define MongoDB schemas, Routes define API endpoints
- **Authentication**: JWT dual-token system (access + refresh tokens) with session management via `services/sessionService.js`
- **RBAC**: Role-based access control via `middleware/rbac.js` with three roles: `user`, `moderator`, `admin`
- **File Storage**: Avatar images stored in MongoDB GridFS (`utils/gridfs.js`)

Key middleware chain in `index.js`:
1. Helmet (security headers with CSP nonces)
2. CORS (restrictive, configured for dev/prod)
3. MongoDB sanitization (injection prevention)
4. Security monitoring
5. Rate limiting (production only, with auth-specific limits)

### Frontend Architecture (client/src/)
- **State Management**: TanStack Query (React Query v5) - no Redux
- **Routing**: React Router v6 with PrivateRoute and AdminRoute guards
- **UI**: Material-UI v5

**Hooks Pattern** (`hooks/`): Custom hooks organized by domain (auth, projects, comments, users, admin). Each hook wraps TanStack Query:
- `useAuth` - Authentication state and token management
- `useProjects`, `useProject` - Project data fetching
- `useComments`, `useCommentMutations` - Comment CRUD
- `useMessaging` - Direct messaging

**Services Pattern** (`services/`): API layer using Axios. Each service corresponds to a backend resource. Central export in `services/index.js`.

### Data Flow
1. Components use domain hooks (e.g., `useProjects`)
2. Hooks call services via TanStack Query
3. Services make HTTP calls with token auth
4. Backend validates via auth middleware, then RBAC
5. Controllers interact with Mongoose models

## Environment Setup

Copy environment templates:
```bash
cp server/example.env server/.env
cp client/example.env client/.env
```

Required server environment variables:
- `MONGODB_URI` - MongoDB connection string
- `JWT_SECRET` - Access token secret (min 32 chars)
- `JWT_REFRESH_SECRET` - Refresh token secret
- `FRONTEND_URL` - Client URL for CORS

## Key Patterns

### Adding a New API Endpoint
1. Create/update route in `server/routes/`
2. Create/update controller in `server/controllers/`
3. Apply middleware: `auth` for authentication, `requireRole`/`requirePermission` from `rbac.js` for authorization

### Adding a New Frontend Feature
1. Create service method in `client/src/services/`
2. Create custom hook in `client/src/hooks/` using TanStack Query
3. Build component using the hook

### Test Users
Development accounts: `user1@example.com` through `user10@example.com` with password `password123`



## Instructions
1. Focus ONLY on implementing this specific feature
2. Make small, incremental changes
3. Test your changes as you go
4. When you are DONE:
   - Commit your changes following conventional commit format:
     * Use: feat(scope), fix(scope), docs(scope), refactor(scope), test(scope)
     * Example: "feat(auth): add user authentication system"
     * Add footer: "ðŸ¤– Committed by claude-swarm worker feature-3"
   - Create a file at: .claude/orchestrator/workers/feature-3.done
     with a brief summary of what you implemented

## Important
- Do not work on other features
- If you encounter a blocker, document it in the .done file and stop
- Keep changes minimal and focused
- Always commit using conventional commit format with the worker attribution footer
- The .claude/ directory is already gitignored - don't worry about it

## Commit Format Example
```bash
# Add only the specific files you changed for this feature
git add src/path/to/file1.ts src/path/to/file2.ts

# Commit with subject and attribution footer
git commit -m "feat(feature-name): implement the feature" -m "ðŸ¤– Committed by claude-swarm worker feature-3"
```


## Additional Context
Update server/middleware/auth.js to read accessToken from cookies with fallback to Authorization header:

// Try cookie first, then Authorization header
let token = req.cookies?.accessToken;
if (!token) {
  token = req.header('Authorization')?.replace('Bearer ', '');
}

This allows both cookie-based and header-based auth during the transition period.

Begin implementing the feature now.